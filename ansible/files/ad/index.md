---
abstract: >
    This is a guide to setting up an AD DC on ArchLinux with Samba.
authors:
    - Xander Harris
date: 2024-01-20
title: ArchLinux AD DC Setup Guide
---

## Samba {term}`AD`

The intent of the {term}`AD` {term}`DC`s is to provide an authentication
backend for at least two etcd servers that will provide a key-value store for a
bare-metal Kubernetes cluster for which the `AD` `DC`s will act as
worker nodes.

```{toctree}
samba/index
```

## Example Config

Here's a {file}`smb.conf` generated by ChatGPT.

```{literalinclude} samba/smb.conf
:language: ini
```

## {file}`smbutil`

You'll need to join a Mac or two to the domain, and you'll need
[smbutil](https://www.unix.com/man-page/osx/1/smbutil/) to do it.

- [Active Directory Naming](https://wiki.samba.org/index.php/Active_Directory_Naming_FAQ)
- [Active Directory DC](https://wiki.archlinux.org/title/Samba/Active_Directory_domain_controller)
- [Active Directory Integration](https://wiki.archlinux.org/title/Active_Directory_integration)

### AD Services by Host

```{list-table}
* - host
  - hostname
  - service
  - ip
* - dc01
  - dc01.int.bh.loc
  - host
  - 172.16.0.9/32
* -
  - ldap01.int.bh.loc
  - lightweight directory access
  - 172.16.0.10/32
* -
  - kdc01.int.bh.loc
  - kerberos
  - 172.16.0.11/32
* -
  - kw01.int.bh.loc
  - kubernetes worker
  - 172.16.0.12/32
* -
  - ns01.int.bh.loc
  - domain name server
  - 172.16.0.13/32
* - dc02
  - dc02.int.bh.loc
  - host
  - - subnet
      - 172.16.0.16/29
    - ip
      - 172.16.0.17/29
* -
  - kdc02.int.bh.loc
  - kerberos
  - 172.16.0.18/32
* -
  - kw02.int.bh.loc
  - kubernetes worker
  - 172.168.0.19/32
* -
  - ldap02.int.bh.loc
  - lightweight directory access
  - 172.168.0.20/32
* -
  - ns02.int.bh.loc
  - domain name server
  - 172.16.0.21/32
```
